---

copyright:

  years:  2016, 2019

lastupdated: "2019-04-02"

subcollection: vmware-solutions


---

{:tip: .tip}
{:note: .note}
{:important: .important}

# 가상 머신 마이그레이션
{: #hcx-archi-migrate-vm}

HCX는 양방향 마이그레이션(온프레미스에서 클라우드로 또는 클라우드에서 온프레미스 데이터 센터로)을 사용으로 설정합니다. HCX는 마이그레이션 프로세스 중에 복제 기술을 사용합니다. 복제 기술은 하이브리드 클라우드 게이트웨이 가상 어플라이언스에서 통합됩니다. 추가 복제 소프트웨어를 설치할 필요가 없습니다.

## 짧은 작동 중단 마이그레이션

짧은 작동 중단 마이그레이션은 호스트 기반 복제를 사용하여 라이브 가상 머신을 vCenter에서 가상 데이터 센터로 또는 반대 방향으로 이동시킵니다. 작동 중단을 줄이기 위해 소스 VM이 복제 중에 온라인 상태로 유지되고 복제 완료 후 대상 ESX 호스트에서 부트스트랩됩니다.

1. 마이그레이션 요청은 다음과 같은 조치를 트리거합니다.
  * 복제는 VCS HCX 가상 데이터 센터에 대한 전체 동기화 전송을 시작합니다. 복제에 걸리는 시간은 VM의 크기와 사용 가능한 대역폭에 따라 다릅니다.
  * 복제 대역폭 이용은 워크로드가 디스크의 블록을 변경하는 방법에 따라 달라집니다.
2. 전체 동기화가 완료되면 델타 동기화가 발생합니다.
3. 델타 동기화가 완료되면 HCX는 전환을 트리거합니다. 전환은 즉시 시작되거나 특정 시간까지 스케줄될 수 있습니다.
4. 전환을 따르면 소스 VM의 전원은 꺼지고 마이그레이션된 복제본의 전원은 켜집니다. 어떠한 이유로 VM의 전원을 켤 수 없으면 새 VM의 전원이 꺼지고(또는 꺼진 상태로 유지됨) 원래 VM의 전원이 켜집니다.
5. HCX는 마이그레이션된 VM과 이름이 충돌하지 않도록 전원이 꺼진 원래 VM의 이름을 변경하고 바이너리 시간소인을 원래 VM 이름에 추가합니다.
6. **MAC 보유**를 사용으로 설정하도록 지정되지 않은 경우 마이그레이션된 VM은 새 MAC 주소를 얻게 됩니다.
7. 마이그레이션이 완료됩니다. 하이브리드 클라우드 서비스는 vSphere 템플리트 보기에서 원래 VM을 **마이그레이션된 VM** 폴더로 복사합니다.

## 중단 없는 vMotion
{: #hcx-archi-migrate-vm-no-downtime-vm}

vMotion은 라이브 가상 머신을 vSphere vCenter에서 VCS 클라우드로 전송합니다. 이 vMotion에는 확장된 네트워크가 필요합니다. vMotion 전송은 가상 머신의 활성 메모리, 실행 상태, IP 주소 및 MAC 주소를 캡처합니다.

가상 머신 하드웨어 버전은 9 이상이어야 하며 교차 클라우드 vMotion은 실패할 수 있습니다.
{:note}

## 콜드 마이그레이션
{: #hcx-archi-migrate-vm-cold-mig}

콜드 마이그레이션은 교차 클라우드 vMotion과 동일한 데이터 플레인을 사용하여 확장된 네트워크를 통해 전원이 꺼진 가상 머신을 전송합니다. IP 주소 및 MAC 주소는 유지됩니다. 가상 머신 요구사항 및 제한사항은 vMotion과 같습니다.

### 양방향 마법사를 사용하여 VM 마이그레이션
{: #hcx-archi-migrate-vm-mig-bidir-wiz}

vSphere Web Client를 사용하여 하이브리드 클라우드 서비스 시작하기 탭에서 양방향 마이그레이션 마법사에 액세스할 수 있습니다. 이 마법사는 다중 가상 머신을 포함하여 모든 마이그레이션 세부사항을 처리합니다.

vSphere Web Client의 하이브리드 클라우드 서비스 시작하기 탭에서 양방향 마이그레이션 마법사에 액세스할 수 있습니다. 이 마법사는 다중 가상 머신을 포함하여 모든 마이그레이션 세부사항을 처리합니다.
* vSphere에서 VCS 하이브리드 클라우드 서비스로
* VCS HCX Cloud에서 vSphere로

### 마이그레이션 전에 VM 확인
{: #hcx-archi-migrate-vm-check-vms}

가상 머신을 마이그레이션하려면 하이브리드 클라우드 게이트웨이에서 유지보수하는 보안 연결이 필요하며 VM은 다음 요구사항을 충족해야 합니다.
* 가상 머신의 전원이 켜져야 합니다.
* 기본 아키텍처는 운영 체제와 관계 없이 x86이어야 합니다.
* vMotion 마이그레이션을 사용하려면 하드웨어 버전은 10 이상이어야 합니다.
* 하드웨어 버전은 10 미만이어야 합니다.
* 호환성 모드에서 원시 디스크 맵핑이 포함된 VM을 마이그레이션할 수 있습니다.

다음 속성이 포함된 VM은 마이그레이션이 지원되지 않습니다.
* 2TB 초과
* VMDK 파일 공유
* 가상 매체 또는 ISO 접속
* 9 미만의 하드웨어 버전

### 마이그레이션 모니터링
{: #hcx-archi-migrate-vm-monitor-mig}

사용자 인터페이스 또는 명령행에서 복제 기반 마이그레이션의 진행상태를 모니터할 수 있습니다. 서비스 어플라이언스 배치 모니터에 설명된 대로 태스크 콘솔을 보고 **VM 마이그레이션** 태스크를 찾아 보십시오. 상태가 **완료됨**이면 VM이 마이그레이션되고 전원이 켜집니다.

이 프로시저는 마이그레이션된 VM의 진행상태를 추적하기 위해 동일한 vCenter에서 관련되지 않은 VM을 사용합니다.

1. 마이그레이션할 VM을 식별하고 마이그레이션하는 VM의 ping을 실행할 수 있는 관찰자 VM을 선택하십시오.
2. 사용자 인터페이스에서 VM 마이그레이션을 시작하고 태스크 콘솔에서 이를 모니터하십시오.
3. SSH를 사용하여 관찰자 VM을 실행하는 ESXi 호스트에 로그인하십시오.
4. 다음 명령을 실행하여 VM ID(vmid)를 얻으십시오.

  ```
  # vim-cmd vmsvc/getallvms | grep -i vmname 5
  ```

5. 다음 명령을 실행하여 복제 상태를 모니터하십시오. 여기서, vmid는 이전 단계에서 얻은 값입니다.

  ```
  # vim-cmd hbrsvc/vmreplica.getState vmid
  # vim-cmd hbrsvc/vmreplica.queryReplicationState vmid 6
  ```

6. ICMP Ping - 지속적인 Ping이 이전에 시작되었는지 모니터합니다.

전환 중에 지속적인 Ping에서 인터럽트가 발생할 수 있습니다. 그러나 Ping 테스트는 태스크 콘솔에 반영된 대로 **VM 마이그레이션** 태스크가 완료되면 빠르게 재개됩니다.

### 마이그레이션된 VM 보기
{: #hcx-archi-migrate-vm-view-vms}

마이그레이션된 가상 머신에서 하이브리드 클라우드 서비스의 전원이 켜진 경우 원래 VM의 전원을 끄고 vCenter의 폴더에 이를 저장합니다. 수동으로 삭제될 때까지 가상 머신이 저장됩니다.

마이그레이션 후 vCenter를 보고 **클라우드에서 마이그레이션된 VM** 및 **클라우드로 마이그레이션된 VM**으로 레이블된 폴더를 기록해 두십시오.
* 복제본으로, 전원이 꺼진 VM은 바이너리 시간소인이 추가된 원래 이름을 갖게 됩니다.
* 마이그레이션된 VM은 다른 VM과 같이 처리될 수 있습니다. 예를 들어, 이를 다른 위치로 이동하고 전원을 켤 수 있습니다.
* 이 폴더 내에서 원하지 않는 VM을 삭제할 수 있습니다.
* 백업 솔루션이 배치되지 않으면 삭제가 최종 단계입니다.

## 관련 링크
{: #hcx-archi-migrate-vm-related}

* [HCX 수정 또는 설치 제거](/docs/services/vmwaresolutions/archiref/hcx-archi?topic=vmware-solutions-hcx-archi-mod-uninstall)
