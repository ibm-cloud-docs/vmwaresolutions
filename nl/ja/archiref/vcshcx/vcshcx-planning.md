---

copyright:

  years:  2016, 2019

lastupdated: "2019-03-22"

subcollection: vmwaresolutions


---

# デプロイメント前の計画
{: #vcshcx-planning}

HCX をデプロイするときに多くの時間がかかるのは、デプロイメント前の段階です。 一般に、情報システムのマイグレーション・プロジェクトの完了には数カ月から数年の時間がかかりますが、HCX の場合はマイグレーションの作業が短期間で完了し、クラウドへのネットワーク接続の作業をデプロイメントの直後に開始できます。

エンタープライズ・レベルのお客様の場合は、HCX のデプロイメントに、
セキュリティー・チーム、ネットワーク・チーム、ストレージ・チーム、vSphere インフラストラクチャー・チームがかかわるのが普通なので、
可能なら POC にもそうしたチームに参加してもらうのが得策です。 HCX のデプロイメントを短時間で実現してすぐに運用に入るには、初期段階からすべての関係者のとりまとめを行って、
効果的なプロジェクト管理を実施することが重要です。

## 分析ばかりしていて作業に入らない状況の回避
{: #vcshcx-planning-avoiding}

1 つの仮想マシン (VM) や 1 群の VM のマイグレーションにはハードルがたくさんあり、
かなりの時間がかかります。アプリケーション環境を部分的に変更することが必要で、
そうした変更の設計作業や、変更を実施するために必要なダウン時間のスケジュール設定などもかかわってくるためです。 変更実施後にマイグレーションを元に戻すのは難しく、そうしたことを考え始めると、どうしても分析ばかりしている状態にはまりがちです。マイグレーションに関係するすべての側面を取り込もうとしたり、チーム間の調整をしたり、重要な関係者を入れ替えたりしているうちに、プロジェクトが遅れていくこともあります。

HCX では、vSphere インスタンスをまたいで 1 つの VM や 1 群の VM (つまり、複合アプリケーションの一部または全体) をマイグレーションできます。
アプリケーションを変更する必要はありません。 そのため、マイグレーションのバックアウトも、
VM を元の場所に戻すかネットワークを再ストレッチするだけで実施できます。 したがって、マイグレーション計画のかなりの部分が不要になり、計画プロセスで幾らかの並列処理も可能になります。 移動するアプリケーションを選択して大まかなネットワーク設計を作成したら、
ネットワークの最終的な接続と設計に取り組みながら、
クラウド・インスタンスの最小限の構成だけでアプリケーションの
マイグレーションを開始できます。

## ストレッチ・ネットワーク
{: #vcshcx-planning-stretched-net}

HCX フリートのネットワーク・ストレッチ・コンポーネントは非常に安定しています。 あるお客様の場合は、
他のトラフィックと共有する 1 Gbps の WAN と HCX のマイグレーション・トンネルを使用して、
20 個を超える VLAN を {{site.data.keyword.cloud}} にストレッチしましたが、
ネットワークに起因するアプリケーションの問題は何も起きませんでした。 そのようにしてネットワーク・リンクを 6 カ月以上稼働させました。

ストレッチ・ネットワークを追加したり除去したりした時にも、問題は起きませんでした。 非常に接近した場所に {{site.data.keyword.CloudDataCent_notm}} を設置したことも (このお客様の場合は待ち時間が 6ms 未満)、
ストレッチ・ネットワーキングの安定性に貢献しています。 ストレッチ・ネットワークを長期間稼働したままにしておくとしても、
アプリケーションの帯域幅が十分にあって待ち時間が十分に短ければ、設計に悪影響を与える要因にはなりません。

## マイグレーション・ライフサイクル
{: #vcshcx-planning-mig-lifecycle}

以下の各セクションで、HCX の標準的なマイグレーション・ライフサイクルの各段階を説明し、
ワーク・ストリームを並行して進められる箇所を示します。

## vSphere インベントリー
{: #vcshcx-planning-vsphere-planning}

- マイグレーションの対象となるアプリケーションにかかわっている VM を大まかに評価します。 つまり、細かい部分にとらわれずに、アプリケーションに関与している VM を大まかに把握します。
- ソース・サイトとクラウド・サイトの間のネットワーク帯域幅が限られている状態で多数の VM をマイグレーションする場合は、
VLAN や VXLAN ごとに VM をグループ分けします (ただし、ソース側で NSX を採用していることが必要です)。 そうすれば、VLAN ごとにグループ分けした VM をマイグレーションし、その VLAN が解放されたところまで関連 L2 ネットワークをストレッチする、という形で HCX のマイグレーション計画を段階的に進められます。

この場合、最初のグループの関連 L2 ストレッチ・ネットワークのストレッチ解除が可能になるのは、
クラウド・サイドのネットワーク設計が最終的に仕上がってデプロイが済んだ後になります。 ストレッチ解除とは、対象の VXLAN トラフィックをスイングして、
クラウド・インスタンスの NSX インフラストラクチャー経由の新しいルートに送付する、ということです。

## ベースライン・ネットワーク構成
{: #vcshcx-planning-baseline-net-config}

クラウド・サイドの vSphere インスタンス内に、セキュアな境界ネットワークを作成します。その構成要素として、通常は、NSX DLR またはエッジ・アプライアンスを使用します。 HCX の隣接ルーティングを使用する場合は、
ファイアウォール・ルールやアップリンク・トポロジーを作成する必要はありません。
その作業は、ストレッチ L2 トラフィックに影響を与えずに後から実行したり並行して実行したりできます。

## 	ネットワーク拡張
{: #vcshcx-planning-net-extension}

ネットワーク拡張とは、
既存の VLAN または VXLAN をソース vSphere 環境 (仮想分散スイッチ・ポート・グループ (vDS) で表される環境) から HCX のクラウド・サイドにある NSX VXLAN に拡張する、
ということを意味します。

## プリフライト・テスト
{: #vcshcx-planning-preflight-tests}

プリフライト・テストでは、vMotion と一括マイグレーションの両方の機能によって HCX のマイグレーションを実行し、
ベースラインの転送速度を確立します。

## 非実稼働アプリのマイグレーション
{: #vcshcx-planning-mig-non-prod-apps}

この時点で、重要度の低い計画段階に入っている VM からマイグレーションを開始します。開発用やテスト用のアプリのマイグレーションやストレッチ L2 トラフィックのためにインターネット接続を使用します。

## クラウド・ネットワークの設計と実装の開始
{: #vcshcx-planning-cloud-net-begins}

マイグレーションを続けながら、クラウド・サイドのネットワーク設計を仕上げて、クラウド・サイドの vSphere インスタンスに実装します。

## ネットワーク接続に関するその他の考慮事項
{: #vcshcx-planning-connect-considerations}

マイグレーションを続けながら、プライベート WAN ネットワーク接続を発注します。
クラウド・プロバイダーによって接続が確立されるまでに、通常は数週間から数カ月の時間がかかります。 プライベート・ネットワーク接続が確立されたら、
マイグレーションとストレッチ L2 トラフィックのために専用のプライベート・ネットワーク・リンクとインターネットの両方を使用するための構成を HCX で行うことができます。

## 物理サーバー
{: #vcshcx-planning-physical-servers}

データ・センターをクラウドにマイグレーションすることが目標である場合は、
マイグレーションする VM と対話する物理サーバーを評価して、VM (P2V) またはベアメタルとして {{site.data.keyword.cloud_notm}} にマイグレーションするか、
ソースにそのまま残すかを判断します。 物理サーバーをソースにそのまま残し、
専用ネットワークが確立されるまでマイグレーションの期間に限って HCX を使用する場合は、
HCX によってクラウドにストレッチしたどのネットワークにも物理サーバーを配置するのかどうかを知っておくことが重要です。 このシナリオでは、
HCX によって VM だけでなくサブネット全体をクラウドにマイグレーションできます。

マイグレーションの終了時に HCX を除去した後に、物理デバイスとマイグレーション済み VM との間の接続を維持する場合は、
そのサブネットをソースと宛先の両方に配置することはできません。 そのため、
ストレッチ L2 ネットワークに存在する物理デバイスをソース・サイトに残したままにする場合は、
クラウド・サイドへのルーティングが可能な別のネットワーク・サブネットにその物理デバイスをマイグレーションする必要があります。 唯一の例外は、
他のストレッチ L2 テクノロジー (NSX L2 VPN など) を採用して HCX ストレッチ L2 エンドポイントを置き換える場合です。

## 実稼働アプリケーションや複雑なアプリケーションのマイグレーション
{: #vcshcx-planning-mig-prod-complex-app}

共有マルチライター VMDK (Oracle RAC や MS Exchange/SQL クラスター) を使用する VM や、
ロー・デバイス・マッピングを使用する VM などの場合は、マイグレーションの前に付加的な考慮事項について検討する必要があります。

## ネットワーク・スイング
{: #vcshcx-planning-net-swing}

ネットワーク・スイングは、ソース・サイド・ネットワークでの VM の移動が完了して、
クラウド・サイドでのネットワーク設計/実装が完了した後に実施します。 マイグレーションの各ウェーブで作業が完了した VM に関連したネットワークのストレッチ解除を HCX で構成すると、マイグレーション済みの VM がクラウド・サイドの NSX インフラストラクチャーを使用してネットワーク・トラフィックをルーティングするようになります。

## サポート対象のクライアント・プラットフォーム
{: #vcshcx-planning-client-platforms}

ネットワーク拡張の場合は、vSphere 仮想分散スイッチ (vDS) を使用するポート・グループだけがサポートされています。 これは、スタンドアロンの ESXi ホストはサポートされていないことを意味します。vDS を使用できるのは、ESXi ホストが vCenter の管理下にある場合に限られるからです。
- vSphere 5.1 (vCenter 5.1 では API を使用したコマンド・ラインだけ)
- vSphere 5.5 (vCenter 5.5u3 以上では Web クライアント UI に対応)
- vSphere 6.0
- vSphere 6.5 (vDS は 6.0 レベルであることが必要)

## サポート対象のクラウド・プラットフォーム
{: #vcshcx-planning-cloud-platforms}

HCX クラウド・サイドは {{site.data.keyword.cloud_notm}} の自動処理によってプロビジョンされます。

## 接続オプション
{: #vcshcx-planning-connect-options}

### 標準の HCX 接続
{: #vcshcx-planning-standard-connect}

HCX クラウド・サイドは {{site.data.keyword.vmwaresolutions_short}} の自動処理によってデプロイされるので、
インストール時にはデフォルトで公共のインターネット経由の接続が構成されます。

### オプションの接続
{: #vcshcx-planning-optional-connect}

注文時に {{site.data.keyword.cloud_notm}} プライベート・ネットワーク経由の接続を選択できます。

## 関連リンク
{: #vcshcx-planning-related}

* [vCenter Server on {{site.data.keyword.cloud_notm}} with Hybridity Bundle の概要](/docs/services/vmwaresolutions/archiref/vcs?topic=vmware-solutions-vcs-hybridity-intro)   
