---

copyright:

  years:  2016, 2019

lastupdated: "2019-07-02"

---

# プロアクティブな作業
{: #opsprocs-proactive}

これらのプロアクティブな検査の目的は、システム管理者が vCenter Server 環境を正常な状態に維持できるようにすることです。 日常的に実行すれば、使用率や容量、パフォーマンスに関する多くの一般的な問題によってワークロードが影響を受けることを防止できるはずです。 これらのプロアクティブな検査は、以下の構成に分類できます。

* 健全性 – 現在、環境の健全性に影響を及ぼしており、ただちに対応して影響を最小限に抑える必要がある問題 (つまりハードウェア障害) を指摘する検査。
* リスク - 差し迫った脅威ではないが、早急に対処する必要がある問題を指摘する検査。 例えば、容量の問題などです。
* 効率性 - パフォーマンスの改善やリソースの再利用に関する領域を指摘する検査。 例えば、仮想マシン (VM) やクラスターのサイズを適正化するなどです。

これらのプロアクティブな作業の多くは、Operations Management on {{site.data.keyword.cloud}} を使用して大幅に単純化でき、管理オーバーヘッドが削減されます。

使用率については、「ベースライン」を把握することが重要です。 このベースラインとは、環境の通常時の運用状態を表すものです。 標準的な処理、vCenter Server インスタンスで実行するワークロードなどに応じて、ベースラインはクライアントごとに異なります。これらのプロアクティブな検査では、そのベースラインと最新の容量/パフォーマンス/使用率を比較します。 要約すると、これらのプロアクティブな使用率検査では、以下の 4 つの質問に答えます。

1. 現在の使用率は高すぎますか?
2. まもなく容量を使い尽くしますか?
3. ピーク使用率が予想される期間に、クラスターのサイズは足りなくなりますか?
4. 仮想インフラストラクチャーの未使用のリソースを再利用できますか?

## ガイドライン
{: #opsprocs-proactive-guidelines}

安定した環境をプロアクティブに維持するために役立つガイドラインを以下に示します。
* 実行するすべての VM に十分なリソースを割り振り、VM デプロイメントを計画します。 vSphere ESXi 自体のリソースも考慮に入れることを忘れないでください。
* VM のサイズを正しく決定し、各 VM に仮想リソースを必要な量だけ割り振ります。 必要以上のリソースを割り当てて VM をプロビジョンすると、その VM や同じホスト上の他の VM のパフォーマンスが低下する可能性があります。
* 一般には、ホストの CPU 使用率は 80% が妥当な上限であり、90% になると CPU が過負荷状態に近づいているという警告を出します。 ホストが CPU 使用率 80% に近づいている場合は、追加のホストをプロビジョンしてください。
* 一般には、ホストの RAM 使用率は 80% が妥当な上限であり、90% になるとホスト全体が使用されているという警告を出します。 ホストが RAM 使用率 80% に近づいている場合は、追加のホストをプロビジョンしてください。
* メモリーの割り振りを不足させないことが重要です。したがって、スラッシングを最小化するために、VM で実行するアプリケーションの作業セットを保持できるだけの十分なメモリーを割り振ってください。 スラッシングが発生すると、アプリケーションのパフォーマンスが大きな影響を受ける可能性があります。 しかし、メモリーの過剰な割り振りも確実に避ける必要があります。
* リソース設定、予約、シェア、制限は、環境に必要な場合にのみ使用します。 使用可能な合計リソースが頻繁に変化することが予想される場合は、
予約ではなくシェアを使用して、リソースを VM 間で公平に割り振ります。 シェアは、リソース競合がある場合のみ有効になります。
* 予約を使用する必要がある場合、CPU またはメモリーの量は、使用可能にしたい量ではなく許容可能な最小量を指定するように構成します。
* リソース管理を委任するためにリソース・プールを使用します。またリソース・プールを完全に分離するために、リソース・プールのタイプを「固定」にして、予約と制限を使用します。
* 多層サービス用の VM をまとめてリソース・プールにします。 こうすると、そのサービスにリソースをまとめて割り当てることができます。 VM のリソース設定 (つまり予約、シェア、制限) は慎重に選択してください。 予約を高く設定しすぎると、未予約のリソースがクラスター内にほとんど残されず、DRS のロード・バランシングが制限されます。
* 制限を低く設定しすぎると、VM がクラスター内の使用可能なリソースを追加で使用してパフォーマンスを向上させることができなくなります。
* 使用率 80% 以下でクラスターを実行すると、VMware Update Manager を使用してホストを修復することができます。 クラスターの修復の成功率が最も高くなるのは、最大 80% の使用率でクラスターを実行する場合です。
* ストレージのシン・プロビジョニングを使用する理由は多数あります。 ただし、シン・プロビジョニングを使用すると容量管理プロセスに注意が必要になるので、環境を保守する管理ワークロードが増加します。
*  VM の拡張を分析し、その拡張をサポートするためにインフラストラクチャーがどのように消費されているかを調べ、拡張を促進するために追加の容量を注文します。
* 計画時には、使用可能な合計容量ではなく、HA とバッファーを考慮に入れた、使用可能な容量を使用します。
* システムで使用可能な最新バージョンの BIOS を実行していることを確認します。
* VM ハードウェアや VM ツールを含め、インストール済みの製品に対して最新の VMware 更新を実行していることを確認します。

## 作業のリスト
{: #opsprocs-proactive-tasks}

表 1. プロアクティブな作業

| タイトル | 説明 |
|---|---|
| 健全性  |  vCenter を使用して、すべてのホストと VM オブジェクトの健全性を検査します。 クラスター、ホスト、データ・ストア、VM、ネットワークにアラームが出ていないか順を追って確認します。  |
| アラームと通知の検査 | 通知されていないアクティブなアラームが vCenter 内に存在する可能性があります。 デフォルトでは、vCenter にはインストール時に多数のアラームが定義されます。 これらのアラームで問題を通知することもできますが、デフォルトでは VMware vSphere Web Client で警告やアラートを表示する以外のアクションは実行されません。 E メールなどの通知を行うように構成できます。 ホストや VM オブジェクトの健全性を検査する際に、アラームを確認して、通知が必要かどうかを判断し、必要に応じて構成します。 通知が必要なのは、最も重要な問題や重大な問題の場合に限られます。 「この問題は午前 2 時に通知する必要があるだろうか、それとも通常の業務時間まで待っても問題ないだろうか」と考えてください。 通知が多すぎると人は通知を「雑音」と見なすようになり、すべてのアラームを無視する傾向にあります。  |
| クラスターの CPU とメモリーの容量/使用率の検査 | vCenter を使用して各クラスターに順番にナビゲートし、「監視」、「パフォーマンス」を選択し、クラスターの CPU とメモリーの容量/使用率のメトリックを確認します。 グラフと統計を確認し、需要を満たすのに十分なリソースがクラスターにあることを確認します。 需要は維持に基づいている必要があります。つまり、必要なときに VM がバーストできる容量、vSphere ESXi ホスト 1 台が障害停止できる容量、既知のサービス要求に従って VM を追加できる容量です。 |
| データ・ストアの容量/使用率の検査  |  vCenter を使用して各データ・ストアに順番にナビゲートし、「監視」、「パフォーマンス」、「スペース (Space)」を選択し、データ・ストアの容量/使用率のメトリックを確認します。 グラフと統計を確認し、需要を満たすのに十分なスペースがデータ・ストアにあることを確認します。 需要は維持に基づいている必要があります。つまり、(vSAN クラスターの) vSphere ESXi ホスト 1 台が障害停止できる容量、既知のサービス要求に従って VM を追加できる容量です。 |
| データ・ストアのパフォーマンスの検査  |  vCenter を使用して各データ・ストアに順番にナビゲートし、「監視」、「パフォーマンス」、「パフォーマンス (Performance)」、「リアルタイム (Real-time)」を選択し、データ・ストアのパフォーマンス・メトリックを確認します。 グラフと統計を参照し、データ・ストアのパフォーマンスのベースラインが想定どおりか、変化がある場合は理由を説明できるか確認します。 異常があれば調査します。 |
| ベア・メタル・サーバーのファームウェア | ベスト・プラクティスは、ベアメタル・サーバー・ホストの最新のファームウェア更新をインストールすることを推奨しています。 ホストごとに順に `control.softlayer.com` にあるリモート管理ページにナビゲートし、OS の再ロードを選択して、ベア・メタル・サーバー・ホストに対するファームウェア更新がないか確認します。 ページが表示されたら、システム・ボードとハード・ディスク・ドライブの現在のバージョンおよび更新バージョンを確認し、利用可能な更新があるかどうかを確認します。 ある場合は、次回の保守時間枠でファームウェアの更新を計画してください。 詳細については、[FAQ: ベア・メタル・サーバー](/docs/bare-metal?topic=bare-metal-bm-faq#what-if-my-bare-metal-server-has-out-of-date-firmware)を参照してください。 |
| vSphere ESXi パッチ適用 | vSphere ESXi パッチの状態を確認する方法については、[ベースラインの作成とインベントリー・オブジェクトへの添付](/docs/services/vmwaresolutions?topic=vmware-solutions-vum-baselines#vum-baselines)を参照してください。 |
| VM ハードウェアの更新 | VM ハードウェア更新が使用可能かを確認する方法については、[ベースラインの作成とインベントリー・オブジェクトへの添付](/docs/services/vmwaresolutions?topic=vmware-solutions-vum-baselines#vum-baselines)を参照してください。 |
| VM ツールの更新 | 詳しくは、[ベースラインの作成とインベントリー・オブジェクトへの接続](/docs/services/vmwaresolutions?topic=vmware-solutions-vum-baselines#vum-baselines)を参照してください。 |
| vSphere vSAN パッチ適用  | vSphere vSAN パッチとパッチ・プロセスの状態を確認する方法については、[vSAN クラスターの更新](/docs/services/vmwaresolutions?topic=vmware-solutions-vum-updating-vsan#vum-updating-vsan)を参照してください。 |
| vCenter パッチ適用 | VCSA パッチの状態を確認して更新を適用する方法については、[VCSA 更新および SSO がリンクされた vCenter](/docs/services/vmwaresolutions?topic=vmware-solutions-vum-updating-vcsa#vum-updating-vcsa)を参照してください。 |
| NSX の更新 | NSX パッチの状態を確認してアップグレードを適用する方法については、[NSX の更新](/docs/services/vmwaresolutions?topic=vmware-solutions-vum-updating-nsx#vum-updating-nsx)を参照してください。 |
| VM ツールがない VM の確認 | VM ツールは OS の操作性が高いので (VM のグレースフル・シャットダウンなど)、VM ツールをインストールすることをお勧めします。 vCenter を使用して、VM ツールがインストールされていない VM を確認できます。 クラスターに移動して、**「関連オブジェクト」**、**「仮想マシン」**を選択してから、テーブル内で**実行中の VM ツール**の列と **VM ツールのバージョン**の列を有効にします。 リストを確認し、必要な場合は VM ツールをインストールします。 |
| スナップショットが使用されている VM | スナップショットを処理する際のベスト・プラクティスについては、[Best practices for using snapshots in the vSphere environment (1025279)](https://kb.vmware.com/s/article/1025279){:new_window} を参照してください。 単一のスナップショットの使用時間が 72 時間を超えるとスナップショット・ファイルが作成されて大きくなり続け、スナップショットの保管場所でスペースが使い尽くされ、システム・パフォーマンスに影響する可能性があるので、スナップショットが使用されている VM が存在するか検出するのは重要です。 スナップショットが使用されている VM を確認するには、Web Client を使用して vCenter に接続し、vCenter Server を選択して「関連オブジェクト」タブに移動します。 列タイトルを右クリックし、「列の表示/非表示 (Show/Hide Columns)」リストに移動します。 列のリストから「統合が必要 (Needs Consolidation)」オプションを選択します。 この列には、現在実行中の全 VM の要約が表示されます。 |
| AD/DNS OS パッチ適用 | Microsoft Active Directory (AD) / ドメイン・ネーム・サーバー (DNS) には、更新プログラムのダウンロードだけが自動的にセットアップされます。 詳しくは、[その他の制限事項と考慮事項](/docs/services/vmwaresolutions?topic=vmware-solutions-trbl_limitations#trbl_limitations)を参照して更新に関する追加のアドバイスを確認してください。 |
| ストレージ待ち時間の検査  |  ストレージ待ち時間を検査して、vSphere ESXi ホストがデータ・ストアにアクセスする際の変化を把握します。 待ち時間が長すぎると、VM 内でホストされているアプリケーションの速度が低下します。 vCenter で、各データ・ストアにナビゲートし、「パフォーマンス」タブで、VM あたりの平均書き込み待ち時間を確認してください。 |
| 仮想デバイスのある VM の確認 | CD やディスケット・ドライブなどの仮想デバイスではオーバーヘッドが発生するため、VM にとって不要なデバイスはすべて除去してください。 |
| vSAN 容量のアドバイス | クラスター内のいずれかの容量デバイスの使用率が 80% の上限に達すると、vSAN は、すべての容量デバイス上の使用可能なスペースがしきい値を下回るまで、クラスターを自動的にリバランスします。 ディスク容量が 80% に達してクラスターのリバランスが開始される操作としては、ハードウェア障害、「すべてのデータを退避する」オプションを指定して vSAN ホストのメンテナンス・モードを開始する操作、PFTT=0 を割り当てられたオブジェクトが vSAN ホスト上に存在する状態で「データ・アクセシビリティーの確保」を指定して vSAN ホストのメンテナンス・モードを開始する操作が考えられます。 保守と再保護のための十分なスペースを提供して、vSAN クラスターのイベントの自動再調整を最小限にするには、常に 30% の容量を使用できるように保つことを考慮してください。 |
| クラスターの使用率の検査 | vCenter を使用して、各クラスターを確認し、CPU と RAM の使用率が 50% 以上のクラスターを検出します。 ホストやクラスターを追加してこのクラスターを拡張する可能性に注意を向けるために、警告レベルとして 50% が選択されています。 50% の使用率と最大値 80% から 90% の差は、サービス要求による追加の VM 用の余地のためです。 この 50% の限度に達したら、近い将来の要求について検討し、リソースの追加がいつ必要になるか予測する必要があります。 |
| クラスター集約の確認 | vCenter を使用して、各クラスターを確認し、 CPU と RAM の使用率が 30% 以下のクラスターを検出します。 ホストを削除したり、このクラスターを削除して別のクラスターに VM を移動したりして、このクラスターのサイズを適正化する可能性に注意を向けるために、警告レベルとして 30% が選択されています。 |
| 大きすぎる VM のサイズの適正化 | 大きすぎる VM のサイズを適正化するには、検出する、プロファイルしてチューニングする、需要の傾向を監視する、という単純な方法を使用します。 vCenter を使用して、サイズを適正化できる可能性がある大きな VM を検出します。 「監視」、「パフォーマンス」にナビゲートし、ワークロードの CPU と RAM の平均需要の側面の経時変化を確認し、仮想リソースを調整します。 最後に、ワークロードの監視を継続して、許容できるパフォーマンスであることを確認します。 VM の消費メモリーは、ゲスト OS で使用されるメモリーに、VM を実行するためのオーバーヘッドを加えたものに近い量が理想的です。|
| 小さすぎる VM のサイズの適正化 | 小さすぎる VM のサイズを適正化するには、単純な方法を使用します。a. 検出する、b. プロファイリングしてチューニングする、c. 需要の傾向を監視する。 サイズを適正化する必要がある小さな VM を検出します。 ワークロードの CPU と RAM の平均需要の側面の経時変化を確認し、仮想リソースを調整します。 最後に、ワークロードの監視を継続して、許容できるパフォーマンスであることを確認します。 VM の消費メモリーは、ゲスト OS で使用されるメモリーに、VM を実行するためのオーバーヘッドを加えたものに近い量が理想的です。|
| VM ハードウェア・デバイスの互換性の検査 | VMware ハードウェア互換オンライン・リソースを使用して、その OS 用に VM のハードウェア・リソース (ネットワークやストレージ・デバイスなど) がサポートされているか検査します。 サポートされていない場合は、サポートされているデバイスに変更して、信頼性とパフォーマンスを改善してください。  |

## 関連リンク
{: #opsprocs-proactive-links}

* [Operations Management on {{site.data.keyword.cloud_notm}}](/docs/services/vmwaresolutions/services?topic=vmware-solutions-opsmgmt-intro)
