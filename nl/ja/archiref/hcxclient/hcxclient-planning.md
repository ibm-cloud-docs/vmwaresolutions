---

copyright:

  years:  2016, 2019

lastupdated: "2019-07-09"

subcollection: vmware-solutions


---

# インストール環境の準備
{: #hcxclient-planning-prep-install}

VMware HCX on IBM Cloud のインストールのソフトウェア要件は、以下のとおりです。
* vSphere 5.5 U3、または vSphere 6.0u2 以上。
* NSX を使用する場合は、バージョン 6.2.2 以上。 ポリシーのマイグレーションには NSX が必要です。
* クラウド間 vMotion を使用する場合は、オンプレミスの場合と同じアフィニティーの制限がクラウド間にも適用されます。 詳しくは、[VMware EVC and CPU Compatibility FAQ](https://kb.vmware.com/s/article/1005764) を参照してください。

## ネットワーク接続の構成
{: #hcxclient-planning-config-net}

HCX は、公衆インターネットと専用回線を経由して、ネットワーク、スイッチ、ポート・グループなどのデータ・センターのコンポーネントに接続する必要があります。
* HCX 仮想アプライアンスを正常にインストールするために開く必要があるポートについて詳しくは、[ポートのアクセス要件](/docs/services/vmwaresolutions/services?topic=vmware-solutions-hcx-archi-port-req)を参照してください。
* オンプレミス vSphere 環境と VCS HCX クラウド環境の両方で、vSphere オンプレミス・デバイスと VCS HCX デバイスが Network Time Protocol (NTP) のクロック同期を許可する必要があります。 UDP ポート 123 に、HCX の仮想アプライアンスとネットワークがアクセスできる必要があります。

## オンプレミス環境
{: #hcxclient-planning-on-prem-env}

HCX をインストールする前に、実行したいタスクがサポートされる環境であることを確認してください。 HCX をインストールするには、オンプレミス環境が、以下のタスクをサポートする環境でなければなりません。
* vSphere 5.5 Update 3 または 6.0 Update 2 の仮想センター。
* vMotion およびポリシー・マイグレーション機能を使用するには、NSX バージョン 6.2.2 以上が必要です。
* vCenter Server システムの管理者の役割を割り当てられた vSphere サービス・アカウント。
* HCX アプライアンスをインストールするための十分なディスク・スペースが vCenter 内にあること。
* インストール中にプロビジョンされるオンプレミス VM 用の十分な IP アドレス。
* 『ポートのアクセス要件』に必要なものとして記載しているポートおよびファイアウォールが開かれていること。
* シングル・サインオン (SSO) サーバーがリモートにある場合は、外部ルックアップ・サービスを実行する vCenter、外部 SSO サーバー、または Platform Services Controller (PSC) の URL を確認する必要があります。 HCX Manager を vCenter に登録するときに、この URL を指定する必要があります。
* vCenter の内部に独自のルックアップ・サービス・インスタンスがない理由としては、以下のいずれかの理由が考えられます。
  * vCenter 6.0u2 が外部 Platform Services Controller を実行している。
  * vCenter がリンク・モードになっている (この場合、2 次 vCenter は 1 次 vCenter の SSO サービスまたは外部 SSO サービスを使用します)。

## レイヤー 2 インストール環境の確認
{: #hcxclient-planning-verify-layer-2-inst}

レイヤー 2 ネットワーク拡張には、次の要件があります。
* vSphere Enterprise Plus エディション。
* レイヤー 2 拡張をサポートするためには、vSphere vCenter が以下の要件を満たしている必要があります。
  * vSphere Enterprise Plus ライセンス
  * vSphere 分散スイッチ (vDS) を備えていること。 分散スイッチは、vSphere Enterprise Plus エディションで提供されます。
  * インストールする場合、オンプレミスのレイヤー 2 コンセントレーター・サービス・アプライアンスは、拡張する vNIC ポートと VLAN にアクセスできなければなりません。
  * 公衆インターネットまたは VPN を経由して (別のパスの) ネットワークを拡張する場合は、VCS 内の L2C 仮想マシンに IP アドレスが必要です。 そのリモート IP アドレスを使用して、レイヤー 2 コンセントレーターを構成する必要があります。
  * 複数台のレイヤー 2 コンセントレーターが必要な場合は、L2C ごとにオンプレミスとクラウドの両方の IP アドレスが必要です。

## デプロイメント前の計画
{: #hcxclient-planning-predepl}

HCX をデプロイするときに多くの時間がかかるのは、デプロイメント前の段階です。 一般に、情報システムのマイグレーション・プロジェクトの完了には数カ月から数年の時間がかかりますが、HCX の場合はマイグレーションの作業が短期間で完了し、クラウドへのネットワーク接続の作業をデプロイメントの直後に開始できます。

エンタープライズ・レベルのお客様の場合は、HCX のデプロイメントに、
セキュリティー・チーム、ネットワーク・チーム、ストレージ・チーム、vSphere インフラストラクチャー・チームがかかわるのが普通なので、
可能なら POC にもそうしたチームに参加してもらうのが得策です。 HCX のデプロイメントを短時間で実現してすぐに運用に入るには、初期段階からすべての関係者のとりまとめを行って、
効果的なプロジェクト管理を実施することが重要です。

## 分析ばかりしていて作業に入らない状況の回避
{: #hcxclient-planning-avoiding}

1 つの仮想マシン (VM) や 1 群の VM のマイグレーションにはハードルがたくさんあり、
かなりの時間がかかります。アプリケーション環境を部分的に変更することが必要で、
そうした変更の設計作業や、変更を実施するために必要なダウン時間のスケジュール設定などもかかわってくるためです。 変更実施後にマイグレーションを元に戻すのは難しく、そうしたことを考え始めると、どうしても分析ばかりしている状態にはまりがちです。 マイグレーションに関係するすべての側面を取り込もうとしたり、チーム間の調整をしたり、重要な関係者を入れ替えたりしているうちに、プロジェクトが遅れていくこともあります。

HCX では、vSphere インスタンスをまたいで 1 つの VM や 1 群の VM (つまり、複合アプリケーションの一部または全体) をマイグレーションできます。
アプリケーションを変更する必要はありません。 そのため、マイグレーションのバックアウトも、
VM を元の場所に戻すかネットワークを再ストレッチするだけで実施できます。 したがって、マイグレーション計画のかなりの部分が不要になり、計画プロセスで幾らかの並列処理も可能になります。 移動するアプリケーションを選択して大まかなネットワーク設計を作成したら、
ネットワークの最終的な接続と設計に取り組みながら、
クラウド・インスタンスの最小限の構成だけでアプリケーションの
マイグレーションを開始できます。

## ストレッチ・ネットワーク
{: #hcxclient-planning-stretched-net}

HCX フリートのネットワーク・ストレッチ・コンポーネントは非常に安定しています。 あるお客様の場合は、
他のトラフィックと共有する 1 Gbps の WAN と HCX のマイグレーション・トンネルを使用して、
20 個を超える VLAN を {{site.data.keyword.cloud}} にストレッチしましたが、
ネットワークに起因するアプリケーションの問題は何も起きませんでした。 そのようにしてネットワーク・リンクを 6 カ月以上稼働させました。

ストレッチ・ネットワークを追加したり除去したりした時にも、問題は起きませんでした。 近くにある {{site.data.keyword.CloudDataCent_notm}} を選択したことも (このお客様の場合は待ち時間が 6ms 未満)、ストレッチ・ネットワーキングの安定性に貢献しています。 ストレッチ・ネットワークを長期間稼働したままにしておくとしても、
アプリケーションの帯域幅が十分にあって待ち時間が十分に短ければ、設計に悪影響を与える要因にはなりません。

## マイグレーション・ライフサイクル
{: #hcxclient-planning-mig-lifecycle}

以下の各セクションで、HCX の標準的なマイグレーション・ライフサイクルの各段階を説明し、
ワーク・ストリームを並行して進められる箇所を示します。

## vSphere インベントリー
{: #hcxclient-planning-vsphere-planning}

- マイグレーションの対象となるアプリケーションにかかわっている VM を大まかに評価します。 つまり、細かい部分にとらわれずに、アプリケーションに関与している VM を大まかに把握します。
- ソース・サイトとクラウド・サイトの間のネットワーク帯域幅が限られている状態で多数の VM をマイグレーションする場合は、
VLAN や VXLAN ごとに VM をグループ分けします (ただし、ソース側で NSX を採用していることが必要です)。 そうすれば、VLAN ごとにグループ分けした VM をマイグレーションし、その VLAN が解放されたところまで関連 L2 ネットワークをストレッチする、という形で HCX のマイグレーション計画を段階的に進められます。

この場合、最初のグループの関連 L2 ストレッチ・ネットワークのストレッチ解除が可能になるのは、
クラウド・サイドのネットワーク設計が最終的に仕上がってデプロイが済んだ後になります。 ストレッチ解除とは、対象の VXLAN トラフィックをスイングして、
クラウド・インスタンスの NSX インフラストラクチャー経由の新しいルートに送付する、ということです。

## ベースライン・ネットワーク構成
{: #hcxclient-planning-baseline-net-config}

クラウド・サイドの vSphere インスタンス内に、セキュアな境界ネットワークを作成します。 その構成要素として、通常は、NSX DLR またはエッジ・アプライアンスを使用します。 HCX の隣接ルーティングを使用する場合は、
ファイアウォール・ルールやアップリンク・トポロジーを作成する必要はありません。
その作業は、ストレッチ L2 トラフィックに影響を与えずに後から実行したり並行して実行したりできます。

## ネットワーク拡張
{: #hcxclient-planning-net-extension}

ネットワーク拡張とは、
既存の VLAN または VXLAN をソース vSphere 環境 (仮想分散スイッチ・ポート・グループ (vDS) で表される環境) から HCX のクラウド・サイドにある NSX VXLAN に拡張する、
ということを意味します。

## プリフライト・テスト
{: #hcxclient-planning-preflight-tests}

プリフライト・テストでは、vMotion と一括マイグレーションの両方の機能によって HCX のマイグレーションを実行し、ベースラインの転送速度を確立します。

## 非実稼働アプリのマイグレーション
{: #hcxclient-planning-mig-non-prod-apps}

重要度の低い計画段階に入っている VM からマイグレーションを開始します。 開発チームとテスト・チームは、マイグレーションやストレッチ L2 トラフィックのためにインターネット接続を使用します。

## クラウド・ネットワークの設計と実装の開始
{: #hcxclient-planning-cloud-net-begins}

マイグレーションを続けながら、クラウド・サイドのネットワーク設計を仕上げて、クラウド・サイドの vSphere インスタンスに実装します。

## ネットワーク接続に関するその他の考慮事項
{: #hcxclient-planning-connect-considerations}

マイグレーションを続けながら、プライベート WAN ネットワーク接続を発注します。
クラウド・プロバイダーによって接続が確立されるまでに、通常は数週間から数カ月の時間がかかります。 プライベート・ネットワーク接続が確立されたら、
マイグレーションとストレッチ L2 トラフィックのために専用のプライベート・ネットワーク・リンクとインターネットの両方を使用するための構成を HCX で行うことができます。

## 物理サーバー
{: #hcxclient-planning-physical-servers}

データ・センターをクラウドにマイグレーションすることが目標である場合は、
マイグレーションする VM と対話する物理サーバーを評価して、VM (P2V) またはベアメタルとして {{site.data.keyword.cloud_notm}} にマイグレーションするか、
ソースにそのまま残すかを判断します。 物理サーバーをソースにそのまま残し、
専用ネットワークが確立されるまでマイグレーションの期間に限って HCX を使用する場合は、
HCX によってクラウドにストレッチしたどのネットワークにも物理サーバーを配置するのかどうかを知っておくことが重要です。 このシナリオでは、HCX によって VM だけでなくサブネット全体をクラウドにマイグレーションできます。

マイグレーションの終了時に HCX を除去した後に、物理デバイスとマイグレーション済み VM との間の接続を維持する場合は、
そのサブネットをソースと宛先の両方に配置することはできません。 そのため、ストレッチ L2 ネットワークに存在する物理デバイスをソース・サイトに残したままにする場合は、クラウド・サイドへのルーティングが可能な別のネットワーク・サブネットにその物理デバイスをマイグレーションする必要があります。唯一の例外は、
他のストレッチ L2 テクノロジー (NSX L2 VPN など) を採用して HCX ストレッチ L2 エンドポイントを置き換える場合です。

## 実稼働アプリケーションや複雑なアプリケーションのマイグレーション
{: #hcxclient-planning-mig-prod-complex-app}

共有マルチライター VMDK (Oracle RAC や MS Exchange/SQL クラスター) を使用する VM や、
ロー・デバイス・マッピングを使用する VM などの場合は、マイグレーションの前に付加的な考慮事項について検討する必要があります。

## ネットワーク・スイング
{: #hcxclient-planning-net-swing}

ネットワーク・スイングは、ソース・サイド・ネットワークでの VM の移動が完了して、
クラウド・サイドでのネットワーク設計/実装が完了した後に実施します。 マイグレーションの各ウェーブで作業が完了した VM に関連したネットワークのストレッチ解除を HCX で構成すると、マイグレーション済みの VM がクラウド・サイドの NSX インフラストラクチャーを使用してネットワーク・トラフィックをルーティングするようになります。

## サポート対象のクライアント・プラットフォーム
{: #hcxclient-planning-client-platforms}

ネットワーク拡張の場合は、vSphere 仮想分散スイッチ (vDS) を使用するポート・グループだけがサポートされています。 これは、スタンドアロンの ESXi ホストはサポートされていないことを意味します。vDS を使用できるのは、ESXi ホストが vCenter の管理下にある場合に限られるからです。
- vSphere 5.1 (vCenter 5.1 では API を使用したコマンド・ラインだけ)
- vSphere 5.5 (vCenter 5.5u3 以上では Web クライアント UI に対応)
- vSphere 6.0
- vSphere 6.5 (vDS は 6.0 レベルであることが必要)

## サポート対象のクラウド・プラットフォーム
{: #hcxclient-planning-cloud-platforms}

HCX クラウド・サイドは {{site.data.keyword.cloud_notm}} の自動処理によってプロビジョンされます。

## 接続オプション
{: #hcxclient-planning-connect-options}

### 標準の HCX 接続
{: #hcxclient-planning-standard-connect}

HCX クラウド・サイドは {{site.data.keyword.vmwaresolutions_short}} の自動処理によってデプロイされるので、
インストール時にはデフォルトで公共のインターネット経由の接続が構成されます。

## 関連リンク
{: #hcxclient-planning-related}

* [HCX のコンポーネントと用語集](/docs/services/vmwaresolutions/services?topic=vmware-solutions-hcxclient-components)
* [HCX クライアントのデプロイメント](/docs/services/vmwaresolutions/services?topic=vmware-solutions-hcxclient-vcs-client-deployment)
* [HCX オンプレミスのサービス・メッシュ](/docs/services/vmwaresolutions/services?topic=vmware-solutions-hcxclient-vcs-mesh-deployment)
* [VMware Hybrid Cloud のマイグレーション](/docs/services/vmwaresolutions/services?topic=vmware-solutions-hcxclient-migrations)
* [パラメーターとコンポーネントのモニター](/docs/services/vmwaresolutions/services?topic=vmware-solutions-hcxclient-monitoring)
* [HCX のトラブルシューティング](/docs/services/vmwaresolutions/services?topic=vmware-solutions-hcxclient-troubleshooting)
