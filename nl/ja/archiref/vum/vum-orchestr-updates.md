---

copyright:

  years:  2016, 2018

lastupdated: "2018-10-05"

---

#	組織的なアップグレード

組織的なアップグレードを使用して、vSphere ESXi ホストの更新後に、インベントリー内の仮想マシンの仮想ハードウェアおよび VMware Tools をアップグレードできます。ホストが更新されると、まず VMware Tools のアップグレード・ベースラインが実行され、続いて仮想マシン・ハードウェアのアップグレード・ベースラインが実行されます。組織的なアップグレードは、クラスター・レベル、フォルダー・レベル、またはデータ・センター・レベルで実行できます。

VUM を使用すると、ベースライン・グループを使用して、ホストの組織的なアップグレードを実行してから、仮想マシンの組織的なアップグレードを実行できます。単一のホスト・アップグレード・ベースラインと複数のパッチ・ベースラインまたは拡張ベースラインを含むベースライン・グループが使用されます。VUM は、まずホストをアップグレードしてから、パッチ・ベースラインまたは拡張ベースラインを適用します。以下のベースラインを含む仮想マシン・ベースライン・グループを使用して、仮想マシンの組織的なアップグレードを実行します。
* ホストと整合するように仮想マシン・ハードウェアをアップグレード
* ホストと整合するように VMware Tools をアップグレード

VUM の組織的なアップグレードでは、VCSA 内のインベントリー・オブジェクトを 2 ステップのプロセスでアップグレードできます。まず、vSphere ESXi ホストがアップグレードされ、続いて仮想マシンのアップグレードが実行されます。この 2 ステップのプロセスは、クラスター・レベルで構成することも、個々の vSphere ESXi ホスト・レベルまたは仮想マシン・レベルで構成してさらに細かく制御することもできます。

組織的なアップグレードでは、ホスト・ベースライン・グループに対してクラスターが最初に修復されて、これによってパッチ、拡張、およびアップグレードが適用されます。アップグレードされたら、「ホストと整合するように仮想マシン・ハードウェアをアップグレード」と「ホストと整合するように VMware Tools をアップグレード」のベースラインを含む、仮想マシン・アップグレード・ベースライン・グループに対してクラスター内の仮想マシンが修復されます。

ベースライン・グループにアップグレード・ベースラインも含まれている場合、VUM はまず vSphere ESXi ホストをアップグレードし、パッチを特定のホスト・バージョンに適用できるように、パッチ・ベースラインまたは拡張ベースライン (あるいはその両方) を適用します。仮想マシンの場合、最初に VMware tools が更新され、その後に仮想ハードウェアの更新が行われます。

したがって、VMware tools のアップグレード中は仮想マシンがパワーオンになります。仮想マシンがパワーオフまたは中断状態の場合は、VUM によってパワーオンになり、アップグレードが実行され、仮想マシンの元のパワー状態が復元されます。そのため、仮想ハードウェアのアップグレード中は、VM がパワーオフ状態である必要があります。パワーオンになっている仮想マシンがある場合、VUM によってシャットダウンされて、仮想ハードウェアがアップグレードされて、パワーオンに戻されます。

デフォルトでは、vSphere ESXi ホストの修復は順次行われ、一度に 1 つのホストが修復されます。あるホストのプロセスが完了すると、VUM によって次のホストの修復が開始されます。このデフォルトは、並行修復を有効にして同時に複数のホストを修復できるように変更できますが、これはクラスター内に十分なフェイルオーバー容量がある場合にのみ可能です。

vSphere ESXI ホストが vSAN クラスターの一部である場合、修復ウィザードで並行修復を選択した場合でも、修復プロセスは常に順次です。これは、vSAN クラスターの 1 つのホストしか保守モードにできないためです。VUM はインテリジェントであり、DRS 設定を中断することなく並行して修復できるホストの数を計算します。

または、修復ウィザードで、並行して修復できるホストの数の制限を定義できます。

以下のワークフローでは、組織的なアップグレードを実行するプロセスについて説明します。

## ステップ 1

1. vSphere Web Client を使用して VCSA にログインします。
2. **「Home」**>**「Update Manager」**を選択して、**「Objects」タブ**から **Update Manager インスタンス**を選択します。
3. **「Manage」タブ**、**「Host Baselines」タブ**をクリックして、**「New Baseline Group」**をクリックします。
4. ベースライン・グループの固有の名前を入力し、**「Next」**をクリックします。
5. ホスト・アップグレード・ベースラインを選択して、ベースライン・グループに含めます。
6. オプションで、「Upgrades」ページの下部にある**「Create a new Host Upgrade Baseline」**をクリックして新しいホスト・アップグレード・ベースラインを作成し、「New Baseline」ウィザードを完了します。**「次へ」**をクリックします。
7. ベースライン・グループに含めるパッチ・ベースラインを選択します。
8. オプションで、「Patches」ページの下部にある**「Create a new Host Patch Baseline」**をクリックして新しいパッチ・ベースラインを作成し、「New Baseline」ウィザードを完了します。**「次へ」**をクリックします。
9. ベースライン・グループに含める拡張ベースラインを選択します。
10. オプションで、「Patches」ページの下部にある**「Create a new Extension Baseline」**をクリックして新しい拡張ベースラインを作成し、「New Baseline」ウィザードを完了します。
11. 「Ready to Complete」ページを確認し、**「Finish」**をクリックすると、「Baseline Groups」ペインにホスト・ベースライン・グループが表示されます。

## ステップ 2

1. VUM 管理ビューで、「ホストと整合するように VMware Tools をアップグレード」ベースラインと「ホストと整合するように仮想マシン・ハードウェアをアップグレード」ベースラインを含む仮想マシン・ベースライン・グループを作成します。
2. アップグレードする仮想マシンを含む vCenter コンテナー・オブジェクトにベースライン・グループを添付します。
3. コンテナー・オブジェクトをスキャンして、コンテナー内の仮想マシンのコンプライアンス状態を表示します。手動でスキャンを開始することも、スキャン・タスクをスケジュールすることもできます。
4. VUM クライアントのコンプライアンス・ビューに表示されるスキャン結果を確認します。
5. コンテナー・オブジェクト内の非準拠仮想マシンを修復して、添付されているベースライン・グループに準拠するようにします。手動で修復を開始することも、修復タスクをスケジュールすることもできます。
* VMware Tools のアップグレード中は、仮想マシンをパワーオンする必要があります。修復前に仮想マシンがパワーオフまたは中断状態の場合は、VUM によってマシンがパワーオンになります。アップグレードが完了すると、VUM によってマシンが再始動して、仮想マシンの元のパワー状態が復元されます。
* 仮想マシン・ハードウェアのアップグレード中は、仮想マシンがシャットダウンされている必要があります。修復が完了すると、VUM によって仮想マシンの元のパワー状態が復元されます。仮想マシンがパワーオンになっている場合、VUM によってマシンがパワーオフになり、仮想ハードウェアがアップグレードされて、仮想マシンがパワーオンになります。

これで、これらのベースライン・グループをスキャン、レビュー、ステージング、および修復の各プロセスで使用できるようになりました。

### 関連リンク

* [VMware HCX on IBM Cloud Solution](https://www.ibm.com/cloud/garage/files/HCX_Architecture_Design.pdf)
* [VMware Solutions on IBM Cloud Digital Technical Engagement](https://ibm-dte.mybluemix.net/ibm-vmware) (デモ)
