---

copyright:

  years:  2016, 2019

lastupdated: "2019-05-16"

---

# 主动任务
{: #opsprocs-proactive}

这些主动检查的目标是支持系统管理员使 vCenter Server 环境保持正常运行状态。通过日常执行这些检查，应该可以防止与利用率、容量和性能相关的许多常见问题影响工作负载。这些主动检查可以分类为以下结构：

* 运行状况 - 这些检查指示当前影响环境运行状况，并需要立即关注以最大限度降低影响的问题，即硬件故障。
* 风险 - 这些检查指示不会立即带来威胁，但应在不久的将来予以解决的问题，即容量问题。
* 效率 - 这些检查指示可提高性能或回收资源的方面。例如，正确调整虚拟机 (VM) 和集群的大小。

通过 Operations Management on {{site.data.keyword.cloud}}，可以大大简化其中许多主动任务的执行，并减少管理开销。

对于利用率，务必要了解“基线”。此基线反映的是环境中的正常运行情况。所有客户机根据基于自己的标准实践以及在 vCenter Server 实例上运行的工作负载等，具有不同的基线。这些主动检查随后会将最近的容量/性能/利用率与此基线进行比较。总而言之，这些主动利用率检查将回答以下 4 个问题：

1. 目前的是否利用过度？
2. 容量是否很快会不足？
3. 对于预期峰值使用时间段，集群的大小是否不足？
4. 是否可以回收虚拟基础架构中未使用的资源？

以下准则可帮助您主动维护稳定的环境：

* 通过为计划运行的所有 VM 分配足够的资源，规划 VM 部署。不要忘记允许资源用于 vSphere ESXi 本身。
* 正确调整 VM 的大小，并仅向每个 VM 分配其所需的虚拟资源量。向 VM 供应超过其需求的资源会降低该 VM 以及同一主机上其他 VM 的性能。
* 通常，主机 CPU 使用率为 80% 是合理的上限，90% 应该作为 CPU 接近超负荷状况的警告值。如果主机的 CPU 使用率接近 80%，请供应更多主机。
* 通常，主机 RAM 使用率为 80% 是合理的上限，90% 应该作为主机达到完全利用的警告值。如果主机的 RAM 使用率接近 80%，请供应更多主机。
* 务必不要分配过少的内存，通过分配足够的内存来保存计划在 VM 中运行的应用程序的工作集，可最大限度地减少系统颠簸。系统颠簸会显著影响应用程序性能。但是，也应该避免大幅地过度分配内存。
* 仅在环境中需要时使用资源设置、保留、共享和限制。如果预期会对总可用资源进行频繁更改，请使用共享（而非保留）在 VM 之间公平分配资源。仅当存在资源争用时，共享才会生效。
* 如果需要使用保留，请将其配置为指定最低可接受的 CPU 量或内存量，而不是指定您希望可用的量。
* 对于委派的资源管理，请使用资源池；要完全隔离资源池，请将资源池类型设置为“固定”，并使用保留和限制。
* 将多层服务的 VM 分组到资源池中。这允许将多个服务作为整体，为其分配资源。请仔细选择用于 VM 的资源设置（即，保留、共享和限制）。设置的保留量太大可能会导致集群中的非保留资源很少，从而限制 DRS 可用于均衡负载的选项。
* 将限制设置得太低可能会使 VM 无法使用集群中可用的额外资源来提高其性能。
* 在资源利用率不超过 80% 的情况下运行集群，以支持提高使用 VMware Update Manager 成功修复主机的可能性。集群在此利用率下运行时，集群修复成功的可能性最高。
* 使用存储器精简配置的原因有很多，但是精简配置会增加维护环境的管理工作负载，因为在容量管理过程中需要非常谨慎。
*  分析 VM 增长情况并了解如何耗尽了基础架构以支持此增长，订购更多容量来促进此增长。
* 规划时使用可用容量（已将 HA/缓冲区等考虑在内），而不是总可用容量。
* 确保运行的是系统可用的最新版本 BIOS。
* 确保运行的是已安装产品（这包括 VM 硬件和 VM Tools）的最新 VMware 更新。

## 任务列表
{: #opsprocs-proactive-tasks}

表 1. 主动任务

|标题|描述|
|---|---|
|运行状况|使用 vCenter 来检查所有主机和 VM 对象的运行状况。有条理地逐步检查集群、主机、数据存储、VM 和网络以查找警报。|
|警报和通知检查|vCenter 中是否有任何您尚未收到通知的活动警报？缺省情况下，vCenter 在安装时已定义多个警报。这些警报可能会提醒您发生了问题，但是缺省情况下，在 vSphere Client 中只会发送警告或警报，而不会执行其他任何操作。可以将这些警报配置为通知，例如电子邮件。检查主机和 VM 对象的运行状况时，请复查任何警报，确定是否需要通知，并根据需要进行配置。仅对于最重要或最严重的问题，您才需要收到通知。请考虑以下问题：是希望在凌晨 2 点收到此问题的通知，还是可以等到正常工作时间再通知？太多的通知会被视为“噪声”，而人的本性就是会忽略所有警报。|
|集群 CPU 和内存容量/利用率检查|使用 vCenter 通过依次导航至每个集群，并选择“监视”>“性能”来复查集群的 CPU 和内存的容量/利用率度量值。复查图形和统计信息，以确保集群有足够的资源来满足需求。需求应基于维护以下事项：足够的容量，能根据需要应对 VM 突增问题；一个 vSphere ESXi 主机，以应对故障；并能根据已知服务请求添加 VM。|
|数据存储容量/利用率检查|使用 vCenter 通过依次导航至每个数据存储，并选择“监视”>“性能”>“空间”来复查数据存储的容量/利用率度量值。复查图形和统计信息，以确保数据存储有足够的空间来满足需求。需求应基于维护；有足够的容量，能应对 vSphere ESXi 主机发生故障（对于 vSAN 集群），并能根据已知服务请求添加 VM。|
|数据存储性能检查|使用 vCenter 通过依次导航至每个数据存储，并选择“监视”>“性能”>“性能”>“实时”来复查数据存储的性能度量值。复查图形和统计信息，以确保数据存储性能基线与预期相符，并且任何变化都有合理的解释。调查任何异常情况。|
|裸机服务器固件|最佳实践是为裸机服务器主机安装最新固件更新。通过在 control.softlayer.com 上依次导航至每个主机的“远程管理”页面，并选择“操作系统重装”，检查是否有裸机服务器主机的固件更新。在显示的页面中，复查主板和硬盘驱动器的“当前版本”和“更新版本”，并查看是否有更新可用。如果有，请规划在下一个维护时段更新固件。有关更多信息，请参阅[常见问题：裸机服务器](/docs/bare-metal?topic=bare-metal-bm-faq#what-if-my-bare-metal-server-has-out-of-date-firmware){:new_window}。|
|vSphere ESXi 修补|有关检查 vSphere ESXi 补丁可用性的信息，请参阅[创建基线并连接到清单对象](/docs/services/vmwaresolutions?topic=vmware-solutions-vum-baselines#vum-baselines){:new_window}。|
|VM 硬件更新|有关检查 VM 硬件更新可用性的信息，请参阅[创建基线并连接到清单对象](/docs/services/vmwaresolutions?topic=vmware-solutions-vum-baselines#vum-baselines){:new_window}。|
|VM Tools 更新|有关更多信息，请参阅[创建基线并连接到库存对象](/docs/services/vmwaresolutions?topic=vmware-solutions-vum-baselines#vum-baselines){:new_window}。|
|vSphere vSAN 修补|有关检查 vSphere vSAN 补丁可用性和修补过程的信息，请参阅[更新 vSAN 集群](/docs/services/vmwaresolutions?topic=vmware-solutions-vum-updating-vsan#vum-updating-vsan){:new_window}。|
|vCenter 修补|有关检查 VCSA 补丁可用性并应用更新的更多信息，请参阅 [VCSA 更新和 SSO 链接的 vCenter](/docs/services/vmwaresolutions?topic=vmware-solutions-vum-updating-vcsa#vum-updating-vcsa){:new_window}。|
|更新 NSX|有关检查 NSX 补丁可用性并应用升级的更多信息，请参阅 [NSX 修补](/docs/services/vmwaresolutions?topic=vmware-solutions-vum-updating-nsx#vum-updating-nsx){:new_window}。|
|检查没有安装 VM Tools 的 VM|最好安装 VM Tools，因为这将支持加强与操作系统的交互，例如正常关闭 VM 的电源。可以使用 vCenter 通过导航至集群，选择“相关对象”> VM，然后在包含表示 VM Tools 正在运行的列和 VM Tools 版本的列的表中，检查哪些 VM 未安装 VM Tools。根据需要复查列表并安装 VM Tools。|
|使用快照的 VM|有关使用快照的最佳实践的信息，请参阅[在 vSphere 环境中使用快照的最佳实践 (1025279)](https://kb.vmware.com/s/article/1025279){:new_window}。识别使用快照的 VM 是否存在非常重要，因为单个快照的使用时间超过 72 小时后，会创建一个快照文件，该文件的大小会持续增长，可能导致快照存储位置空间不足，并影响系统性能。要复查使用快照的 VM，请使用 Web Client 连接到 vCenter，选择 vCenter Server，然后转至“相关对象”选项卡。右键单击列标题，并转至“显示/隐藏列”列表。从列的列表中，选择“需要合并”选项。此列会显示当前在一个快照上运行的所有 VM。|
|AD/DNS 操作系统修补|Microsoft Active Directory (AD) / 域名服务器 (DNS) 自动设置为仅下载更新。有关更多信息，请参阅[更多限制和注意事项](/docs/services/vmwaresolutions?topic=vmware-solutions-trbl_limitations#trbl_limitations){:new_window}，以获取进一步的更新建议。|
|检查存储器等待时间|检查存储器等待时间可了解访问数据存储的 vSphere ESXi 主机的任何变化。等待时间过长会导致在 VM 中托管的应用程序的速度变慢。在 vCenter 中，导航至每个数据存储，并使用“性能”选项卡来复查每个 VM 的平均写等待时间。|
|复查使用虚拟设备的 VM|虚拟设备（例如，CD 或软盘驱动器）会生成开销，因此，请除去 VM 不需要的任何设备。|
|vSAN 容量建议|集群中的任何容量设备的使用率达到 80% 时，vSAN 都会自动重新均衡集群，直到所有容量设备上的可用空间低于此阈值。以下操作可能会导致磁盘容量使用率达到 80%，并启动集群重新均衡：硬件故障；通过“转移所有数据”选项，将 vSAN 主机置于维护模式；或者在分配有 PFTT=0 的对象位于 vSAN 主机上时，通过“确保数据可访问性”，将 vSAN 主机置于维护模式。要提供足够的空间用于维护和重新保护，并尽可能减少 vSAN 集群中的自动重新均衡事件，请考虑始终保持 30% 的可用容量。|
|集群利用率检查|使用 vCenter 来复查每个集群，并确定哪些集群的 CPU 和 RAM 的利用率达到或超过 50%。选择 50% 作为警告级别，以重点关注通过更多主机来潜在扩展此集群或者添加新集群。50% 利用率与最高 80% 到 90% 之间的差异即是可根据服务请求添加更多 VM 的空间。在达到 50% 的限制时，应该考虑不久的将来的请求，并预测何时需要添加更多资源。|
|集群合并复查|使用 vCenter 来复查每个集群，并确定哪些集群的 CPU 和 RAM 利用率不超过 30%。选择 30% 作为警告级别，以重点关注通过除去主机来潜在正确调整此集群的大小，或者除去此集群，并将 VM 移至其他集群。|
|对过大的 VM 正确调整大小|使用简单的方法来对过大的 VM 正确调整大小：a. 识别，b. 进行剖析并调整，以及 c. 监视需求趋势。使用 vCenter 可识别有潜力进行正确大小调整的大型 VM。导航至“监视”>“性能”，随时间推移对工作负载的平均 CPU 和 RAM 需求概要信息进行剖析，并调整虚拟资源。最后，继续监视工作负载，以查看性能是否可接受。理想情况下，VM 的耗用内存应该接近于访客操作系统使用的内存加上运行 VM 的开销。|
|对过小的 VM 正确调整大小|使用简单的方法来对过小的 VM 正确调整大小：a. 识别，b. 进行剖析并调整，以及 c. 监视需求趋势。确定需要正确调整大小的小型 VM。随时间推移对工作负载的平均 CPU 和 RAM 需求概要信息进行剖析，并调整虚拟资源。最后，继续监视工作负载，以查看性能是否可接受。理想情况下，VM 的耗用内存应该接近于访客操作系统使用的内存加上运行 VM 的开销。|
|检查 VM 硬件设备兼容性|使用 VMware 硬件兼容性联机资源，检查该操作系统是否支持网络和存储设备等 VM 硬件资源。如果不支持这些资源，请更改为受支持的设备，以提高可靠性和性能。|

## 相关链接
{: #opsprocs-proactive-links}

* [Operations Management on {{site.data.keyword.cloud_notm}}](/docs/services/vmwaresolutions/services?topic=vmware-solutions-opsmgmt-intro)
