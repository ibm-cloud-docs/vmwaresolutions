---

copyright:

  years:  2016, 2019

lastupdated: "2019-07-02"

---

# 主動作業
{: #opsprocs-proactive}

這些主動檢查的目標是讓系統管理者能夠將 vCenter Server 環境保持在健全狀態。每天執行檢查時，應該可以防止與使用情況、容量和效能相關的許多常見問題影響工作負載。這些主動檢查可分類為下列結構：

* 性能 - 檢查指出目前影響環境性能的問題，需要立即注意，以將影響降到最低，亦即硬體故障。
* 風險 - 檢查指出不會有立即威脅，但需要在不久的將來處理的問題。例如，容量問題。
* 效率 - 檢查指出要改善效能或收回資源的區域。例如，正確調整虛擬機器 (VM) 及叢集大小。

其中許多主動作業都可以使用 Operations Management on {{site.data.keyword.cloud}} 進行更簡單的作業，並降低管理的額外負擔。

對於使用率，務必要瞭解「基準線」。這個基準線反映您環境中的正常作業。根據所有用戶端的標準作法，所有用戶端都有不同的基準線（vCenter Server 實例上執行的工作負載等）。這些主動檢查接著會比較最新容量/效能/使用率與這個基準線。總而言之，這些主動使用率檢查將回答以下四個問題：

1. 我現在是否過度使用？
2. 我很快就會耗盡容量嗎？
3. 我的叢集對於預期尖峰使用期間是否太小？
4. 是否可以收回虛擬基礎架構中的未用資源？

## 準則
{: #opsprocs-proactive-guidelines}

下列準則可協助您主動維護穩定環境：
* 針對您計劃執行的所有 VM 配置足夠的資源，來規劃 VM 部署。不要忘記容許 vSphere ESXi 本身的資源。
* 正確調整 VM 的大小，並僅向每個 VM 配置其所需的虛擬資源量。佈建超過所需資源的 VM，可能會降低相同主機上該 VM 及其他 VM 的效能。
* 通常，主機 CPU 使用率為 80% 是合理的上限，90% 應該作為 CPU 接近超載狀況的警告值。如果主機的 CPU 使用率接近 80%，請佈建更多主機。
* 通常，主機 RAM 使用率為 80% 是合理的上限，90% 應該作為主機達到完全利用的警告值。如果主機的 RAM 使用率接近 80%，請佈建更多主機。
* 很重要的是不要配置不足的記憶體，因此請配置足夠的記憶體來保留您計劃要在 VM 中執行之應用程式的工作集，以盡量減少衝擊。衝擊可能會明顯地影響應用程式效能。不過，您也應該避免大幅過度配置記憶體。
* 只有在環境中需要時，才會使用資源設定、保留、共用及限制。如果您預期經常變更可用資源總計，請使用共用（而非保留），在 VM 之間平均地配置資源。只有在資源競用時，共用才會生效。
* 如果您確實需要使用保留，請將它們配置為指定可接受的 CPU 或記憶體數量下限，而不是您想要使用的數量。
* 使用資源儲存區進行委派的資源管理，以及完整隔離資源儲存區，以將資源儲存區類型設為「固定」，並使用「保留」和「限制」。
* 將多層服務的 VM 分組至資源儲存區。這容許整體指派服務的資源。請小心選取 VM 的資源設定（亦即，保留、共用及限制）。設定保留太高，可能會在叢集裡留下少數未保留資源，因此限制 DRS 進行負載平衡時擁有的選項。
* 設定限制太低，可能會讓 VM 無法使用叢集裡可用的額外資源來改善其效能。
* 在資源使用率不超過 80% 的情況下執行叢集，以容許使用 VMware Update Manager 來補救主機。當叢集以不超過 80% 的使用率執行時，叢集補救最有可能成功。
* 使用儲存空間的精簡佈建有多種原因。但是，精簡佈建會增加維護環境的管理工作負載，因為在容量管理程序中需要非常謹慎。
*  分析 VM 成長狀況，並瞭解基礎架構的使用如何達到支援此成長、訂購更多容量以加速此成長。
* 規劃時，請使用可使用的容量，這會將 HA/緩衝區列入考量，而非可用容量總計。
* 確定您執行系統可用 BIOS 的最新版本。
* 確定您執行已安裝產品的最新 VMware 更新，其中包括 VM 硬體及 VM 工具。

## 作業清單
{: #opsprocs-proactive-tasks}

表 1. 主動作業

|標題|說明       |
|---|---|
| 性能 | 使用 vCenter，檢查所有主機及 VM 物件的性能。有條理地逐步檢查叢集、主機、資料儲存庫、VM 和網路以尋找警示。|
| 警示及通知檢查 | vCenter 中是否有任何您尚未收到通知的作用中警示？依預設，vCenter 具有一些安裝時定義的警示。這些警示可能會提醒您發生了問題，但是依預設，在 VMware vSphere Web Client 中只會發送警告或警示，而不會執行其他任何動作。它們可以配置為通知，例如電子郵件。當您檢查主機及 VM 物件的性能時，請檢閱所有警示、決定是否需要通知，並視需要進行配置。您只需要收到最重要或嚴重問題的通知。請考慮下列情況：我希望在凌晨 2 點收到有關此問題的通知，還是可以等到正常工作時間？太多的通知會被視為「雜訊」，而人的本性就是會忽略所有警示。|
| 叢集 CPU 及記憶體容量/使用率檢查 | 使用 vCenter，依次導覽至每個叢集，並選取「監視」、「效能」，來檢閱叢集 CPU 及記憶體的容量/使用率度量值。請檢閱圖形及統計資料，以確保叢集有足夠的資源可滿足需求。需求應該是基於維護下列項目：足夠的容量，讓 VM 在需要時快速激增、供 vSphere ESXi 主機故障時使用，以及根據已知服務要求來新增 VM。|
| 資料儲存庫容量/使用率檢查 | 使用 vCenter，依次導覽至每個資料儲存庫，並選取「監視」、「效能」、「空間」，來檢閱資料儲存庫的容量/使用率度量值。請檢閱圖形及統計資料，以確保資料儲存庫有足夠的空間可滿足需求。需求應該是基於維護下列項目：足夠的容量，供 vSphere ESXi 主機故障時使用（針對 vSAN 叢集），以及根據已知服務要求來新增 VM。|
| 資料儲存庫效能檢查 | 使用 vCenter，依次導覽至每個資料儲存庫，並選取「監視」、「效能」、「效能」、「即時」，來檢閱資料儲存庫的效能度量值。請檢閱圖形及統計資料，以確保預期有資料儲存庫效能基準線，且可以說明所有變更。請調查所有異常狀況。|
| 裸機伺服器韌體 |建議的最佳作法是為裸機伺服器主機安裝最新韌體更新。請檢查裸機伺服器主機上的韌體更新，方法為依次導覽至每個主機的 `control.softlayer.com` 遠端管理頁面，然後選取 OS 重新載入。在顯示的頁面上，檢閱主機板和硬碟的現行版本和更新版本，並查看是否有更新可用。若是如此，請規劃在下次維護時間更新韌體。如需相關資訊，請參閱[常見問題：Bare Metal Server](/docs/bare-metal?topic=bare-metal-bm-faq#what-if-my-bare-metal-server-has-out-of-date-firmware)。|
| vSphere ESXi 修補 |如需檢查 vSphere ESXi 修補程式可用性的相關資訊，請參閱[建立基準線並連接至庫存物件](/docs/services/vmwaresolutions?topic=vmware-solutions-vum-baselines#vum-baselines)。|
| VM 硬體更新 |如需檢查 VM 硬體更新可用性的資訊，請參閱[建立基準線並連接至庫存物件](/docs/services/vmwaresolutions?topic=vmware-solutions-vum-baselines#vum-baselines)。|
| VM 工具更新 |如需相關資訊，請參閱[建立基準線並連接至庫存物件](/docs/services/vmwaresolutions?topic=vmware-solutions-vum-baselines#vum-baselines)。|
| vSphere vSAN 修補 |如需檢查 vSphere vSAN 修補程式可用性及修補處理程序的相關資訊，請參閱[更新 vSAN 叢集](/docs/services/vmwaresolutions?topic=vmware-solutions-vum-updating-vsan#vum-updating-vsan)。|
| vCenter 修補 |如需檢查 VCSA 修補程式可用性及套用更新的相關資訊，請參閱 [VCSA 更新及 SSO 鏈結的 vCenter](/docs/services/vmwaresolutions?topic=vmware-solutions-vum-updating-vcsa#vum-updating-vcsa)。|
| 更新 NSX |如需檢查 NSX 修補程式可用性及套用升級的相關資訊，請參閱[NSX 修補](/docs/services/vmwaresolutions?topic=vmware-solutions-vum-updating-nsx#vum-updating-nsx)。|
| 不使用 VM 工具檢查 VM | 最佳作法是安裝 VM 工具，因為這容許與 OS 進行更大的互動，例如循序關閉 VM 的電源。您可以使用 vCenter 來檢查哪些 VM 未安裝 VM Tools。移至叢集、選取**相關物件**、**VM**，然後是表格中啟用以**執行 VM Tools** 的直欄及 **VM Tools 版本**。檢閱清單並根據需要安裝 VM 工具。|
| 具有 Snapshot 的 VM | 如需使用 Snapshot 時的最佳作法的相關資訊，請參閱[在 vSphere 環境中使用 Snapshot 的最佳作法 (1025279)](https://kb.vmware.com/s/article/1025279){:new_window}。識別具有 Snapshot 的 VM 是否存在很重要，因為使用單一 Snapshot 超過 72 小時會建立一個大小持續成長的 Snapshot 檔案，可能導致 Snapshot 儲存空間位置耗盡空間，並影響系統效能。若要檢閱具有 Snapshot 的 VM，請使用 Web Client 連接至 vCenter、選取 vCenter Server，然後移至「相關物件」標籤。用滑鼠右鍵按一下直欄標題，然後移至「顯示/隱藏直欄」清單。從直欄清單中，選擇「需要合併」選項。此直欄會顯示目前執行中的所有 VM 的摘要。|
| AD/DNS OS 修補 | Microsoft Active Directory (AD) / 網域名稱伺服器 (DNS) 自動設定為只下載更新。如需相關資訊，請參閱[其他限制及考量](/docs/services/vmwaresolutions?topic=vmware-solutions-trbl_limitations#trbl_limitations)，以進一步更新建議。|
| 檢查儲存空間延遲 | 檢查儲存空間延遲，以瞭解對 vSphere ESXi 主機存取資料儲存庫的所有變更。等待時間過長會導致在 VM 中管理的應用程式的速度變慢。在 vCenter 中，移至每個資料儲存庫，並在「效能」標籤上檢閱每個 VM 的平均寫入延遲。|
| 檢閱具有虛擬裝置的 VM |虛擬裝置（例如，CD 或軟式磁碟機）會產生額外負擔，因此請移除 VM 不需要的任何裝置。|
| vSAN 容量建議 | 當叢集裡的任何容量裝置達到 80% 滿時，vSAN 會自動重新平衡叢集，直到所有容量裝置上的可用空間低於臨界值為止。下列作業可能會導致磁碟容量達到 80% 並起始叢集重新平衡：硬體故障、使用「撤除所有資料」選項讓 vSAN 主機進入維護模式，或獲指派 PFTT=0 的物件駐留在主機上時，使用「確保資料存取性」讓 vSAN 主機進入維護模式。若要提供足夠的空間來進行維護及重新保護，並將 vSAN 叢集中的自動重新平衡事件減到最少，請考慮隨時保留 30% 的可用容量。|
| 叢集使用率檢查 |使用 vCenter 來檢閱每個叢集，並確定哪些叢集的 CPU 和 RAM 的使用率達到或超過 50%。已選擇 50% 作為警告層次，以將注意力集中在以額外的主機或叢集進行此叢集的潛在擴充。50% 使用率與最高 80% 到 90% 使用率之間的差異即是可根據服務要求新增更多 VM 的空間。在達到 50% 的限制時，應該考慮不久的將來的要求，並預測何時需要新增更多資源。|
| 叢集合併檢閱 |使用 vCenter 來檢閱每個叢集，並確定哪些叢集的 CPU 和 RAM 使用率不超過 30%。已選擇 30% 作為警告層次，以藉由移除主機或移除此叢集並將 VM 移至另一個叢集，將注意力集中在此叢集可能需要進行的正確大小調整。|
| 正確調整大小過大的 VM | 使用簡單方法將大小過大的 VM 調整為正確大小：對需求趨勢進行識別、側寫並調整以及監視。使用 vCenter 識別可能需要進行正確大小調整的大型 VM。導覽至「監視」>「效能」，以及側寫一段時間之工作負載的平均 CPU 和 RAM 需求設定檔，並調整虛擬資源。最後，繼續監視工作負載，以查看效能可接受。理想情況下，使用的 VM 的記憶體數量應該接近來賓 OS 所使用的記憶體，再加上執行 VM 的額外負擔。|
| 正確調整大小過小的 VM | 使用簡單的方法來正確調整大小過小的 VM：a. 識別、b. 側寫並調整，以及 c. 監視需求趨勢。確定需要正確調整大小的小型 VM。側寫一段時間之工作負載的平均 CPU 和 RAM 需求設定檔，並調整虛擬資源。最後，繼續監視工作負載，以查看效能可接受。理想情況下，使用的 VM 的記憶體數量應該接近來賓 OS 所使用的記憶體，再加上執行 VM 的額外負擔。|
| 檢查 VM 硬體裝置相容性 |使用 VMware 硬體相容性線上資源，檢查該作業系統是否支援網路和儲存裝置等 VM 硬體資源。如果不予支援，則請變更為支援的裝置，以提高可靠性及效能。|

## 相關鏈結
{: #opsprocs-proactive-links}

* [Operations Management on {{site.data.keyword.cloud_notm}}](/docs/services/vmwaresolutions/services?topic=vmware-solutions-opsmgmt-intro)
